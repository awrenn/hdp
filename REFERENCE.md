# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

* [`hdp::app_stack`](#hdpapp_stack): This class takes care of configuring a node to run HDP.
* [`hdp::data_processor`](#hdpdata_processor): Simple class to enable the HDP data processor
* [`hdp::resource_collector`](#hdpresource_collector): This class adds module to the node, which adds our custom facts. Without it, we don't have the ability to pull all ral resources

### Data types

* [`HDP::Url`](#hdpurl)

### Tasks

* [`get_service_status`](#get_service_status): Get the status of the HDP docker-compose services
* [`update_all_images`](#update_all_images): Automates the dance needed to get docker-compose to update the container for every service
* [`use_updated_image`](#use_updated_image): Automates the dance needed to get docker-compose to use an updated image

## Classes

### <a name="hdpapp_stack"></a>`hdp::app_stack`

This class takes care of configuring a node to run HDP.

#### Examples

##### Use defalts or configure via Hiera

```puppet
include hdp::app_stack
```

##### Manage the docker group elsewhere

```puppet
realize(Group['docker'])

class { 'hdp::app_stack':
  create_docker_group => false,
  require             => Group['docker'],
}
```

#### Parameters

The following parameters are available in the `hdp::app_stack` class:

* [`create_docker_group`](#create_docker_group)
* [`manage_docker`](#manage_docker)
* [`hdp_port`](#hdp_port)
* [`hdp_query_port`](#hdp_query_port)
* [`hdp_ui_http_port`](#hdp_ui_http_port)
* [`hdp_ui_https_port`](#hdp_ui_https_port)
* [`hdp_manage_es`](#hdp_manage_es)
* [`hdp_es_host`](#hdp_es_host)
* [`hdp_es_username`](#hdp_es_username)
* [`hdp_es_password`](#hdp_es_password)
* [`hdp_manage_s3`](#hdp_manage_s3)
* [`hdp_s3_endpoint`](#hdp_s3_endpoint)
* [`hdp_s3_region`](#hdp_s3_region)
* [`hdp_s3_access_key`](#hdp_s3_access_key)
* [`hdp_s3_secret_key`](#hdp_s3_secret_key)
* [`hdp_s3_facts_bucket`](#hdp_s3_facts_bucket)
* [`hdp_s3_force_path_style`](#hdp_s3_force_path_style)
* [`hdp_s3_disable_ssl`](#hdp_s3_disable_ssl)
* [`hdp_user`](#hdp_user)
* [`compose_version`](#compose_version)
* [`image_repository`](#image_repository)
* [`image_prefix`](#image_prefix)
* [`ca_server`](#ca_server)
* [`ca_cert_file`](#ca_cert_file)
* [`key_file`](#key_file)
* [`cert_file`](#cert_file)
* [`ui_use_tls`](#ui_use_tls)
* [`ui_cert_files_puppet_managed`](#ui_cert_files_puppet_managed)
* [`ui_key_file`](#ui_key_file)
* [`ui_cert_file`](#ui_cert_file)
* [`ui_ca_cert_file`](#ui_ca_cert_file)
* [`dns_name`](#dns_name)
* [`dns_alt_names`](#dns_alt_names)
* [`hdp_version`](#hdp_version)
* [`ui_version`](#ui_version)
* [`frontend_version`](#frontend_version)
* [`log_driver`](#log_driver)
* [`Optional[Array[String[1]]]`](#Optional[Array[String[1]]])
* [`max_es_memory`](#max_es_memory)
* [`docker_users`](#docker_users)

##### <a name="create_docker_group"></a>`create_docker_group`

Data type: `Boolean`

Ensure the docker group is present.

Default value: ``true``

##### <a name="manage_docker"></a>`manage_docker`

Data type: `Boolean`

Install and manage docker as part of app_stack

Default value: ``true``

##### <a name="hdp_port"></a>`hdp_port`

Data type: `Integer`

Port to access HDP upload service

Default value: `9091`

##### <a name="hdp_query_port"></a>`hdp_query_port`

Data type: `Integer`

Port to access HDP query service

Default value: `9092`

##### <a name="hdp_ui_http_port"></a>`hdp_ui_http_port`

Data type: `Integer`

Port to access HDP UI via http

Default value: `80`

##### <a name="hdp_ui_https_port"></a>`hdp_ui_https_port`

Data type: `Integer`

Port to access HDP UI via https if `ui_use_tls` is true

Default value: `443`

##### <a name="hdp_manage_es"></a>`hdp_manage_es`

Data type: `Boolean`

= true
Allow this module to manage elasticsearch
If true, all other es parameters are ignored

Default value: ``true``

##### <a name="hdp_es_host"></a>`hdp_es_host`

Data type: `String[1]`

Elasticsearch host to use

Default value: `'http://elasticsearch:9200/'`

##### <a name="hdp_es_username"></a>`hdp_es_username`

Data type: `Optional[String[1]]`

Username to use to connect to elasticsearch

Default value: ``undef``

##### <a name="hdp_es_password"></a>`hdp_es_password`

Data type: `Optional[String[1]]`

Password to use to connect to elasticsearch

Default value: ``undef``

##### <a name="hdp_manage_s3"></a>`hdp_manage_s3`

Data type: `Boolean`

Allow this module to manage S3 itself. If true,
All other s3 parameters are ignored.

Default value: ``true``

##### <a name="hdp_s3_endpoint"></a>`hdp_s3_endpoint`

Data type: `String[1]`

The S3 Endpoint to use

Default value: `'http://minio:9000/'`

##### <a name="hdp_s3_region"></a>`hdp_s3_region`

Data type: `String[1]`

The S3 Region to use

Default value: `'hdp'`

##### <a name="hdp_s3_access_key"></a>`hdp_s3_access_key`

Data type: `String[1]`

The S3 Access Key to use

Default value: `'puppet'`

##### <a name="hdp_s3_secret_key"></a>`hdp_s3_secret_key`

Data type: `String[1]`

The S3 Secret Key to use

Default value: `'puppetpuppet'`

##### <a name="hdp_s3_facts_bucket"></a>`hdp_s3_facts_bucket`

Data type: `String[1]`

The S3 Bucket to use for facts

Default value: `'facts'`

##### <a name="hdp_s3_force_path_style"></a>`hdp_s3_force_path_style`

Data type: `Boolean`

Disable AWS specific S3 Path Style

Default value: ``true``

##### <a name="hdp_s3_disable_ssl"></a>`hdp_s3_disable_ssl`

Data type: `Boolean`

Disable SSL for the S3 backend

Default value: ``true``

##### <a name="hdp_user"></a>`hdp_user`

Data type: `String[1]`

User to run HDP + all infra services as. Also owns mounted volumes
Set to Puppet if certname == dns_name

Default value: `'11223'`

##### <a name="compose_version"></a>`compose_version`

Data type: `String[1]`

The version of docker-compose to install

Default value: `'1.25.0'`

##### <a name="image_repository"></a>`image_repository`

Data type: `Optional[String[1]]`

Image repository to pull images from - defaults to dockerhub.
Can be used for airgapped environments/testing environments

Default value: ``undef``

##### <a name="image_prefix"></a>`image_prefix`

Data type: `String`

Prefix that comes before each image
Can be used for easy name spacing under the same repository

Default value: `'puppet/hdp-'`

##### <a name="ca_server"></a>`ca_server`

Data type: `Optional[String[1]]`

URL of Puppet CA Server. If no keys/certs are provided, then
HDP will attempt to provision its own certs and get them signed.
Either this or ca_cert_file/key_file/cert_file can be specified.
If autosign is not enabled, HDP will wait for the certificate to be signed
by a puppet administrator

Default value: ``undef``

##### <a name="ca_cert_file"></a>`ca_cert_file`

Data type: `Optional[String[1]]`

CA certificate to validate connecting clients
This or ca_server can be specified

Default value: ``undef``

##### <a name="key_file"></a>`key_file`

Data type: `Optional[String[1]]`

Private key for cert_file - pem encoded.
This or ca_server can be specified

Default value: ``undef``

##### <a name="cert_file"></a>`cert_file`

Data type: `Optional[String[1]]`

Puppet PKI cert file - pem encoded.
This or ca_server can be specified

Default value: ``undef``

##### <a name="ui_use_tls"></a>`ui_use_tls`

Data type: `Boolean`

Use TLS for the UI and HDP Query endpoints

Default value: ``false``

##### <a name="ui_cert_files_puppet_managed"></a>`ui_cert_files_puppet_managed`

Data type: `Boolean`

Indicate if the cert files used by the UI are managed by Puppet. If they
are then a relationship is created between these files and the
`docker_compose` resource so that containers are restarted when
the contents of the files change, such as when the certificate is renewed.

Default value: ``true``

##### <a name="ui_key_file"></a>`ui_key_file`

Data type: `Optional[String[1]]`

Key file to use for UI - pem encoded.
Your browser should trust this you set ui_use_tls

Default value: ``undef``

##### <a name="ui_cert_file"></a>`ui_cert_file`

Data type: `Optional[String[1]]`

Cert file to use for UI - pem encoded.
Your browser should trust this you set ui_use_tls

Default value: ``undef``

##### <a name="ui_ca_cert_file"></a>`ui_ca_cert_file`

Data type: `Optional[String[1]]`

CA Cert file to use for UI - pem encoded.
Setting this to anything but undef will cause the HDP to validate clients with mTLS
If you don't have access to a puppet cert and key in your browser, do not set this parameter.
It is unlikely that you want this value set.

Default value: ``undef``

##### <a name="dns_name"></a>`dns_name`

Data type: `String[1]`

Name that puppet server will find HDP at.
Should match the names in cert_file if provided.
If ca_server is used instead, this name will be used as certname.

##### <a name="dns_alt_names"></a>`dns_alt_names`

Data type: `Array[String[1]]`

Extra dns names attached to the puppet cert, can be used to bypass certname collisions

Default value: `[]`

##### <a name="hdp_version"></a>`hdp_version`

Data type: `String[1]`

The version of the HDP Data container to use

Default value: `'0.0.1'`

##### <a name="ui_version"></a>`ui_version`

Data type: `Optional[String[1]]`

The version of the HDP UI container to use
If undef, defaults to hdp_version

Default value: ``undef``

##### <a name="frontend_version"></a>`frontend_version`

Data type: `Optional[String[1]]`

The version of the HDP UI TLS Frontend container to use
If undef, defaults to hdp_version

Default value: ``undef``

##### <a name="log_driver"></a>`log_driver`

Data type: `String[1]`

The log driver Docker will use

Default value: `'journald'`

##### <a name="Optional[Array[String[1]]]"></a>`Optional[Array[String[1]]]`

Data type: `Optional[Array[String[1]]] docker_users
Users to be added to the docker group on the system`

docker_users
Users to be added to the docker group on the system

##### <a name="max_es_memory"></a>`max_es_memory`

Data type: `String[1]`

Max memory for ES to use - in JVM -Xmx{$max_es_memory} format.
Example: 4G, 1024M. Defaults to 4G.

Default value: `'4G'`

##### <a name="docker_users"></a>`docker_users`

Data type: `Optional[Array[String[1]]]`



Default value: ``undef``

### <a name="hdpdata_processor"></a>`hdp::data_processor`

Simple class to enable the HDP data processor

#### Examples

##### Configuration via Hiera with default port

```puppet
---
hdp::data_processor::hdp_url: 'https://hdp.example.com/in'
hdp::data_processor::pe_console: 'pe-console.example.com'
```

##### Configuration via Hiera with custom port

```puppet
---
hdp::data_processor::hdp_url: 'https://hdp.example.com:9091/in'
hdp::data_processor::pe_console: 'pe-console.example.com'
```

##### Configuration in a manifest with default port

```puppet
# Settings applied to both a master and compilers
class { 'profile::masters_and_compilers':
  class { 'hdp::data_processor':
    hdp_url  => 'https://hdp.example.com/in',
    pe_console => 'pe-console.example.com',
  }
}
```

##### Configuration in a manifest with custom port

```puppet
# Settings applied to both a master and compilers
class { 'profile::masters_and_compilers':
  class { 'hdp::data_processor':
    hdp_url  => 'https://hdp.example.com:9091/in',
    pe_console => 'pe-console.example.com',
  }
}
```

##### Send data to two HDP servers

```puppet
---
hdp::data_processor::hdp_url:
  - 'https://hdp-prod.example.com:9091/in'
  - 'https://hdp-staging.example.com:9091/in'
```

#### Parameters

The following parameters are available in the `hdp::data_processor` class:

* [`hdp_url`](#hdp_url)
* [`extra_hdp_urls`](#extra_hdp_urls)
* [`enable_reports`](#enable_reports)
* [`manage_routes`](#manage_routes)
* [`facts_terminus`](#facts_terminus)
* [`facts_cache_terminus`](#facts_cache_terminus)
* [`collect_resources`](#collect_resources)
* [`keep_node_re`](#keep_node_re)
* [`reports`](#reports)

##### <a name="hdp_url"></a>`hdp_url`

Data type: `HDP::Url`

The url to send data to.

##### <a name="extra_hdp_urls"></a>`extra_hdp_urls`

Data type: `Array[HDP::Url]`

Extra HDP urls to send data to.
Most common use case is 1 hdp.

Default value: `[]`

##### <a name="enable_reports"></a>`enable_reports`

Data type: `Boolean`

Enable sending reports to HDP

Default value: ``true``

##### <a name="manage_routes"></a>`manage_routes`

Data type: `Boolean`

Enable managing the HDP routes file

Default value: ``true``

##### <a name="facts_terminus"></a>`facts_terminus`

Data type: `String[1]`



Default value: `'hdp'`

##### <a name="facts_cache_terminus"></a>`facts_cache_terminus`

Data type: `String[1]`



Default value: `'hdp'`

##### <a name="collect_resources"></a>`collect_resources`

Data type: `Boolean`



Default value: ``true``

##### <a name="keep_node_re"></a>`keep_node_re`

Data type: `String[1]`



Default value: `'.*'`

##### <a name="reports"></a>`reports`

Data type: `String[1]`

A string containg the list of report processors to enable

Default value: `'puppetdb,hdp'`

### <a name="hdpresource_collector"></a>`hdp::resource_collector`

This class adds module to the node, which adds our custom facts.
Without it, we don't have the ability to pull all ral resources

## Data types

### <a name="hdpurl"></a>`HDP::Url`

The HDP::Url data type.

Alias of

```puppet
Variant[Array[Stdlib::HTTPUrl], Stdlib::HTTPUrl]
```

## Tasks

### <a name="get_service_status"></a>`get_service_status`

Get the status of the HDP docker-compose services

**Supports noop?** false

### <a name="update_all_images"></a>`update_all_images`

Automates the dance needed to get docker-compose to update the container for every service

**Supports noop?** false

### <a name="use_updated_image"></a>`use_updated_image`

Automates the dance needed to get docker-compose to use an updated image

**Supports noop?** false

#### Parameters

##### `service`

Data type: `Enum[frontdoor,identity,influxdb,ingest-queue,mongo,query,rabbitmq,ui]`

The service you wish to update

